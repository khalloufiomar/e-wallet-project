<div class="container-fluid">
  <!-- Header section -->
  <div class="header">
    <div class="title">Invoices</div>
    <div class="profile">
      <!-- <img src="icone.png" alt="Profile" class="profile-image" /> -->
      <i class="bi bi-person-circle fs-4 text-dark"></i>
    </div>
  </div>

  <!-- Card section -->
  <div class="card">
    <div class="header-card">
      <div class="transaction-history">
        <i class="fa fa-exchange-alt"></i> Invoices History
      </div>
      <div class="right-section">
        <div class="buttons">
          <button class="filter-btn">
            <i class="fa fa-filter"></i> Filter
          </button>
        </div>
      </div>
    </div>

    <!-- Spinner affiché pendant le chargement -->
    <div *ngIf="loading" class="text-center my-4">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>

    <!-- Table affichée seulement quand loading = false -->
    <table *ngIf="!loading" class="transactions-table">
      <thead>
        <tr>
          <th><input type="checkbox" /></th>
          <th>Ref</th>
          <th>Date</th>
          <th>Amount</th>
          <th>Device</th>
          <th>payment_state</th>
        </tr>
      </thead>
      <tbody>
        <tr
          *ngFor="let invoice of invoices"
          [ngClass]="{ 'not-paid-row': invoice.payment_state === 'not_paid' }"
          (click)="openInvoiceDetails(invoice)"
        >
          <td><input type="checkbox" /></td>
          <td>{{ invoice.ref }}</td>

          <td>{{ invoice.date | date : "yyyy-MM-dd HH:mm" }}</td>
          <td>{{ invoice.montant }}</td>
          <td>{{ invoice.device }}</td>
          <!-- Etat de paiement avec ngClass pour changer de fond -->
          <td
            [ngClass]="{
              'status-completed': invoice.payment_state === 'paid',
              'status-pending': invoice.payment_state === 'not_paid'
            }"
          >
            <div class="status-text">{{ invoice.payment_state }}</div>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Pagination affichée seulement quand loading = false -->
    <div *ngIf="!loading && invoices.length > 5" class="pagination">
      <div class="showing">
        Showing 1 to 5 of {{ invoices.length }} invoices
      </div>
      <div class="pagination-buttons">
        <button class="prev-btn"><i class="fa fa-chevron-left"></i></button>
        <button class="page-btn current-page">1</button>
        <button class="page-btn next-page">2</button>
        <button class="next-btn"><i class="fa fa-chevron-right"></i></button>
      </div>
    </div>
  </div>
</div>

<!-- Modal: Invoice Details -->
<div
  class="modal fade"
  id="invoiceModal"
  tabindex="-1"
  aria-labelledby="invoiceModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow rounded-4">
      <div class="modal-header border-0 pb-1">
        <h5 class="modal-title fw-bold" id="invoiceModalLabel">
          Invoice Details
        </h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>

      <div class="px-4 d-flex justify-content-between align-items-center mb-2">
        <div class="fw-bold text-uppercase">{{ selectedInvoice.ref }}</div>
        <div class="text-primary fs-4"><i class="fas fa-euro-sign"></i></div>
      </div>

      <hr class="my-0 text-secondary opacity-25" />

      <div class="modal-body" *ngIf="selectedInvoice">
        <!-- Date -->
        <div class="mb-3">
          <p class="mb-1 text-muted">Date</p>
          <p class="fw-medium mb-0">
            {{ selectedInvoice.date | date : "dd/MM/yyyy" }}
          </p>
        </div>

        <!-- Amount + Currency -->
        <div class="d-flex justify-content-between mb-3">
          <div>
            <p class="mb-1 text-muted">Amount</p>
            <p class="fw-bold fs-5 mb-0">
              {{ selectedInvoice.montant | number : "1.2-2" }} €
            </p>
          </div>
          <div class="text-end">
            <p class="mb-1 text-muted">Currency</p>
            <p class="fw-medium mb-0">{{ selectedInvoice.device }}</p>
          </div>
        </div>

        <!-- Payment Status -->
        <div class="mb-3">
          <p class="mb-1 text-muted">Payment Status</p>
          <p
            [ngClass]="{
              'text-success fw-bold': selectedInvoice.payment_state === 'paid',
              'text-danger fw-bold':
                selectedInvoice.payment_state === 'not_paid'
            }"
          >
            {{ selectedInvoice.payment_state === "paid" ? "Paid" : "Not Paid" }}
          </p>
        </div>

        <hr class="my-0 text-secondary opacity-25" />

        <!-- PayPal Button (if not paid) -->
        <div class="d-grid gap-2 mt-3">
          <ngx-paypal
            *ngIf="selectedInvoice.payment_state === 'not_paid'"
            [config]="payPalConfig"
          ></ngx-paypal>
          <button
            class="btn btn-outline-secondary rounded-pill"
            data-bs-dismiss="modal"
          >
            Cancel
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
